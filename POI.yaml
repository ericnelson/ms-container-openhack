apiVersion: apps/v1
kind: Deployment
metadata:
  name: poi 
  namespace: api 
spec:
  replicas: 1
  selector:
    matchLabels:
      app: poi
  template:
    metadata:
      annotations:
        linkerd.io/inject: enabled
      labels:
        app: poi
    spec:
      containers:
      - name: poi
        image: registryvhd1032.azurecr.io/tripinsights/poi:latest
        ports:
        - containerPort: 80
        env:
        - name: SQL_USER
          value: "sqladminvHd1032"
        - name: SQL_SERVER
          value: "sqlservervhd1032.database.windows.net"
        - name: SQL_DBNAME
          value: "mydrivingDB"
        volumeMounts:
        - name: sql-password
          mountPath: /secrets
          readOnly: true
      volumes:
        - name: sql-password
          csi:
            driver: secrets-store.csi.k8s.io
            readOnly: true
            volumeAttributes:
              secretProviderClass: "tripsinsightssec"
      nodeSelector:    
        kubernetes.io/os: linux
---
apiVersion: v1
kind: Service
metadata:
  name: poi
  namespace: api 
spec:
  type: ClusterIP
  ports:
  - port: 80
  selector:
    app: poi
---
apiVersion: v1
kind: Secret
metadata:
  name: certificates
  namespace: api
type: Opapue
data:
  certificate.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURoRENDQW13Q0ZHZUNPVWNYQ0JxT2ZoUWp0TjZxRU1iRThCaURNQTBHQ1NxR1NJYjNEUUVCQ3dVQU1IOHgKQ3pBSkJnTlZCQVlUQWxWVE1Rc3dDUVlEVlFRSURBSkRUekVQTUEwR0ExVUVCd3dHUkdWdWRtVnlNUkV3RHdZRApWUVFLREFoUGNHVnVTR0ZqYXpFTE1Ba0dBMVVFQ3d3Q1NWUXhGakFVQmdOVkJBTU1EVlJ5YVhCemFXNXphV2RvCmRITXhHakFZQmdrcWhraUc5dzBCQ1FFV0MyaGxiSEJBYlhNdVkyOXRNQjRYRFRJd01Ea3hNVEU1TXpNME5Wb1gKRFRJek1EWXdPREU1TXpNME5Wb3dmakVMTUFrR0ExVUVCaE1DVlZNeEN6QUpCZ05WQkFnTUFrTlBNUTh3RFFZRApWUVFIREFaRVpXNTJaWEl4RVRBUEJnTlZCQW9NQ0U5d1pXNUlZV05yTVFzd0NRWURWUVFMREFKSlZERVZNQk1HCkExVUVBd3dNVkhKcGNHbHVjMmxuYUhSek1Sb3dHQVlKS29aSWh2Y05BUWtCRmd0b1pXeHdRRzF6TG1OdmJUQ0MKQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFNK3ZIY2htUmtlNDJUano5djZSQ21CVwprcW5VdnNYcFM5K204ZFFYSXpBaU9KaE1rQUxycGNwWDR5OXdORGt5aDlQZlZDYTRzbXgxT3ViQXdqMlRwNHV0Cjdvckp3SEVYL0x2eVFsckxmZ0V0YU9IWWFYRVhZY2NuMFBMd0ZEUndMV1dueE5ZNVBUWDVhK2MrcTlkU1VhK0cKMU5FNzJPeHhEOUp6OXpzYVZ3UG12QUgwSGQ2clVVOTBNY1Frc09lakZ0VDU4N2grU09VQmNScWlYWll4dWxxUgpTcHlDVUl4MmpubmRnSDZ2UkFYMTFoZTBJUmhTOGVsakJielE0YVZjTjM1MmlQMXdmWXA3L1FjUTJJMGpteDRZCnE0cjNYR0NFRVpZOERXTlFoVW9SM3F4YWtSQ0FMS1pRS2JOOTJ3dHNLTjljeitzNldzOVlVbkt2ak5ZVXRNMEMKQXdFQUFUQU5CZ2txaGtpRzl3MEJBUXNGQUFPQ0FRRUFDNzViVnB1WXIzUlBhT2hucWdBa2RmSkFzenZOTEVNdwpiYmtnVkxPWm5WSGNwcGZBRTBGUDVxZ1ZoZXZYUFZUNjJ3b2RFY0V3RU9HRkxpRjlneFhtYVM0VjdSZjEvbTZiClc2aURaRXlMSW1Fc2tNM1JNaXoxcDY2OXNvV1RPQjFCUjBzSkRCUXprQkl1Q0dEQUdWSlRTMXJVQlJpTjR3THcKZ09iNW1pcWZOK2FzY21xQThGS2I3VE5hTWxTdTdFV3dLWE9QT0hoNFhWV052LzVYNURITDlWNDNHdFJsTk92SgpJZ1U2b2JIZHpEMmN5bHFyTnRlR3ZpNGduNngzcFBpYVIwNm9mZG42R1h4VlZQQlNkWnJlZzJUWU9jUXhDRW44Ck1YUmdXWElCOWV4dlphSGpQUll4UlpVOW9jT2x5VTBmZnAvUGdadmdZMTdhUG8rTWxzanVUQT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBejY4ZHlHWkdSN2paT1BQMi9wRUtZRmFTcWRTK3hlbEwzNmJ4MUJjak1DSTRtRXlRCkF1dWx5bGZqTDNBME9US0gwOTlVSnJpeWJIVTY1c0RDUFpPbmk2M3Vpc25BY1JmOHUvSkNXc3QrQVMxbzRkaHAKY1JkaHh5ZlE4dkFVTkhBdFphZkUxams5TmZscjV6NnIxMUpScjRiVTBUdlk3SEVQMG5QM094cFhBK2E4QWZRZAozcXRSVDNReHhDU3c1Nk1XMVBuenVINUk1UUZ4R3FKZGxqRzZXcEZLbklKUWpIYU9lZDJBZnE5RUJmWFdGN1FoCkdGTHg2V01Gdk5EaHBWdzNmbmFJL1hCOWludjlCeERZalNPYkhoaXJpdmRjWUlRUmxqd05ZMUNGU2hIZXJGcVIKRUlBc3BsQXBzMzNiQzJ3bzMxelA2enBhejFoU2NxK00xaFMwelFJREFRQUJBb0lCQUVVc0NqdG85UmVHVmJORwpib216UFVXQkVEQklqNUhUZGxYemdMQW5WS3ovZU9JZy9nWTYvbWs2aEl5VVRwQ09aL2NGZHoyK1hvOEpMS2tXCm9wdG54bkliYUV3SmpuTWNqaXo3TDJhV1NFMlVGazdDaWJ3RkVhZ0hkdXl6VWNkMVpXbHFTNEVlWjJqR3ZrMnkKN2dFMWhjZDBuUVZqYllpeXo1WkUwWjk1MG1tVm9tbVJsWXBhT0ZTd3FnMVErRU42c3dPMEU1Q1MvbFIvdUtFUApLZkRqZjJZN1Bkc2ZMTWpJWktvZnBTUVpMNUlOK2dWcEVBajlkSDdqM0R5WHczRXBxbmpjWWtEWmJPQ1BFdnp5CjQ0NVk3enVBaHZKMGpKYzJtcDhkVTJBRDNXQnRMOXJkcmY5bkxkbisvdURvcWp6TzlXUFpLaUF3SWdzcWhkYlIKRXRMd1NJRUNnWUVBNzgrWFpTYWFRTnMvejBLMCtLNE1vWDF0WVQyN2ZUSkY4SmFVRUJyVG5VekR2bVdvQmNERgpCT3ZxMStESEFvSEw4dm5LVjdWc1VqbitNUGlQRjJqaU5JVGJoemY1ZGlNN2RrYmNTSk56ODRXVHovTXdzVmI3CkFVTU5lRU9XZmpzYy80MWNueUxRbms5NmJjRzhJVytMSVlaQ011OEE4VmNHak5CL0pFQjVQVWtDZ1lFQTNiUlAKSUtGZEs5MEtzYythaUM1N1VGalRqeGdmRmJ0TEZrd2prTXppV3cwMWdSRi9uS2h5MkhwdHc5UTBUZlQ0S01ubgplSlJVTVh2NVVZdythWElKa1RycnROSWlrUkZETktkMTU3dk5uUEVMajV0azZnc0x5VitkUkNOQkJrM3QrT0FRCmp4NWQ2ZjN0SWhMSnpjK1A4RWYvZVl6NENYN3RhanVhMVVlbVQyVUNnWUVBb1BhUTR2Y1BNSnM1Y0UrUkV4NFkKSWtrREl2TUJwcDRZN2N6VVl4N3VqVFdhYVhEb1g3d3RRZ2xzSHl5ang1NEJtL3hvQVlrbnhPVmlKZEtna1JENApURklrMjlVSlgyOTBtUVlsRTUzTmhWWlNpWkR0VFF0Wi9WWFpjN0RDRWNaeHgySkdHaGFQT3NPVUpKbVdRa2NSCmR4WWIxdjR2ZnM1ditoSjBWSXZtRk9rQ2dZQVA0N0ZjSEZTS0pVQno5L1lTVm9wOStxL0c3S3FscXhPNW1HRmcKS2w3NnVacWhFbmo3NkZLNjB5TjB5b3VwSHFwK2VlSCtFVnRyWklBODZQazhJM0V1R0hQMk5LMUhpbDR2c3VUUApZL1ZianljTjlzd252Znp0Uk00SHFTTXE2WURwdWwxVmRJNjBpMzlvVnNKaDNzTnBMQy9TTFZsRmpQUkZEZHFOCitLR2h4UUtCZ0gyU2EvQ1hINCttQzdvOHBsVSt6WEF3SldhdGRySUJqVU9yYzZuaVhNN3h0Sm9YTWpJVVNvQ1EKVXBEbDU3a1BQN0UwY242bU1zaldhN0lpL01qUXBSZnArVERURjBLWk94VDVrcnRwWXhaa1RiQmdDNGcyb2dUeAp6VFRiSENaK1JsSUlRTWRIQi9JN3JqenFKMWw0bkZjU3hHRFdpOXJhbHg3UGR5RTNlRzBpCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
  cacertificate.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUQzekNDQXNlZ0F3SUJBZ0lVQ3hxQ1laOTUvdCswdDNyRld0NTJXRjZRUUhrd0RRWUpLb1pJaHZjTkFRRUwKQlFBd2Z6RUxNQWtHQTFVRUJoTUNWVk14Q3pBSkJnTlZCQWdNQWtOUE1ROHdEUVlEVlFRSERBWkVaVzUyWlhJeApFVEFQQmdOVkJBb01DRTl3Wlc1SVlXTnJNUXN3Q1FZRFZRUUxEQUpKVkRFV01CUUdBMVVFQXd3TlZISnBjSE5wCmJuTnBaMmgwY3pFYU1CZ0dDU3FHU0liM0RRRUpBUllMYUdWc2NFQnRjeTVqYjIwd0hoY05NakF3T1RFeE1Ua3oKTURFM1doY05OREF3T1RBMk1Ua3pNREUzV2pCL01Rc3dDUVlEVlFRR0V3SlZVekVMTUFrR0ExVUVDQXdDUTA4eApEekFOQmdOVkJBY01Ca1JsYm5abGNqRVJNQThHQTFVRUNnd0lUM0JsYmtoaFkyc3hDekFKQmdOVkJBc01Ba2xVCk1SWXdGQVlEVlFRRERBMVVjbWx3YzJsdWMybG5hSFJ6TVJvd0dBWUpLb1pJaHZjTkFRa0JGZ3RvWld4d1FHMXoKTG1OdmJUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQU96SHk5N1BCNkNyMnE3NQpnZ3NiRStFcmZHeTh4bWF4UWxXS3AzaVJHaFIvUWVuZUpuTWhuM2NNMFZhbHM4TmluenNFNjhZNFlYYUNZUG9lClNPQXUwaVpxU1JWbEEwSHpyVklnM0pTQUNrV0hLZUd1eU42S0NBUlZ5Vm11ak5NbGRZNXZpVHV2VHZxMk1melUKUzZub2tJTWJ0d2NITDJlODdTd3N4NlVzb1BzRE1JMnQyRnhMKzdndFVVUEl0RThzTVpOZG1wS0FpN3hXWTVvbwp0RElBdHAwSFNLNElaeTBQRVRoVy81SmdVQ3gybWV2RVM0QkswWXBHWWpjdXJ2Z2RNcnkwQXM3MFZ3RTEycWpDClhzck9HNExuUVlWWm92b3M2UEJPWUhZR1FJelR4ck1VU1J0WGUwdkxmZUlIU0puZHZQcFArQUhjSXhzOG5xVSsKRzVZQTN0MENBd0VBQWFOVE1GRXdIUVlEVlIwT0JCWUVGRVJqaDdNK0RlZWJvK0JUQ29rMHBwbTFrV1prTUI4RwpBMVVkSXdRWU1CYUFGRVJqaDdNK0RlZWJvK0JUQ29rMHBwbTFrV1prTUE4R0ExVWRFd0VCL3dRRk1BTUJBZjh3CkRRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFNTVRuaittU0cyaCt6a2F2OWtwY3I3QXZZelVpRjNkTWpVZWNRSzUKYWpqNElJMWZzc3NJeGZ4dmw4eGsrcVVhMnhCOWJpZEt2bk5Ncjh2RXNOVEg1UXphby9SQUdGVUpsUFFxaC9vVwprcDBoNGJhMzJpdXl3eW1rdUtsWS9xV0ZJQm5ObU1pVTBUY2tCR2VTNjE4MkdFdG13NHNTZXQwcUZQMGlDUUxFClQ0VFlObmdubFF4cjlyelFJM3kxcEdzMjZDRzN5NlkvWEZ6VCtTTlJzb0UxNFFzU2c4UlNTbG5uRWRCU2FvQ1UKdXRpRGZuS2tOMzJMQi9IOXA0YjRCSy9qRWlTRlJtR2wvTGRiZ0MwWFVuU0lrS1BPQ2tQb2JsbTRwdG1kZm51WQo0V3R0SDU3ekp2YUd5dkhrY3J1cG5FK1pYbGlCSjJYNHBMc0Z5bkJjejBrVzBPQT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=